<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ¯ç‡æ›ç®— - UNCLE FAT'S TOOL BOX</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="navbar">
        <a href="index.html" class="navbar-brand">UNCLE FAT'S TOOL BOX</a>
        <div id="datetime-display" class="nav-links"></div>
    </nav>

    <div class="container">
        <h2><center>åŒ¯ç‡æ›ç®—</center></h2>

        <div class="calculator-section">
            <h3>ä¸»è¦è²¨å¹£åŒ¯ç‡</h3>
            <div class="converter-controls">
                <button id="resetRateTableBtn" class="reset-btn">é‡è¨­</button>
            </div>
            <div id="rateTableContainer" class="unit-converter-grid"></div>
            <div class="info-footer">
                <p id="lastUpdated" class="last-updated-info"></p>
                <p class="disclaimer-info">åŒ¯ç‡è³‡æ–™ä¾†æºç‚º <a href="https://www.exchangerate-api.com" target="_blank" rel="noopener">ExchangeRate-API</a>ã€‚æœ¬æ›ç®—çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›äº¤æ˜“åŒ¯ç‡ä»¥éŠ€è¡Œå…¬å‘Šç‚ºæº–ã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // --- å°è¦½åˆ—æ™‚é–“æ›´æ–° ---
        function updateDateTime() {
            const now = new Date();
            const dateTimeString = now.toLocaleString('sv-SE').replace('T', ' '); // YYYY-MM-DD HH:MM:SS
            
            const displayElement = document.getElementById('datetime-display');
            if (displayElement) {
                displayElement.textContent = dateTimeString;
            }
        }
        updateDateTime();
        setInterval(updateDateTime, 1000);

        // --- åŒ¯ç‡æ›ç®—é‚è¼¯ ---
        const lastUpdatedEl = document.getElementById('lastUpdated');
        const rateTableContainerEl = document.getElementById('rateTableContainer');
        const resetRateTableBtn = document.getElementById('resetRateTableBtn');

        const API_BASE_URL = 'https://open.er-api.com/v6/latest';
        const majorCurrencies = ['USD', 'TWD', 'CNY', 'HKD', 'GBP', 'AUD', 'CAD', 'SGD', 'CHF', 'JPY', 'ZAR', 'SEK', 'NZD', 'THB', 'PHP', 'IDR', 'EUR', 'KRW', 'VND', 'MYR'];
        const currencyNames = {
            TWD: 'æ–°å°å¹£',
            USD: 'ç¾å…ƒ',
            EUR: 'æ­å…ƒ',
            JPY: 'æ—¥åœ“',
            KRW: 'éŸ“å…ƒ',
            CNY: 'äººæ°‘å¹£',
            HKD: 'æ¸¯å¹£',
            SGD: 'æ–°åŠ å¡å¹£',
            THB: 'æ³°éŠ–',
            GBP: 'è‹±éŠ',
            AUD: 'æ¾³å¹£',
            CAD: 'åŠ æ‹¿å¤§å¹£',
            CHF: 'ç‘å£«æ³•éƒ',
            ZAR: 'å—éå¹£',
            SEK: 'ç‘å…¸å…‹æœ—',
            NZD: 'ç´è¥¿è˜­å¹£',
            PHP: 'è²å¾‹è³“æŠ«ç´¢',
            IDR: 'å°å°¼ç›¾',
            VND: 'è¶Šå—ç›¾',
            MYR: 'é¦¬ä¾†è¥¿äºä»¤å‰',
        };
        const currencyFlags = {
            USD: 'ğŸ‡ºğŸ‡¸', TWD: 'ğŸ‡¹ğŸ‡¼', CNY: 'ğŸ‡¨ğŸ‡³', HKD: 'ğŸ‡­ğŸ‡°', GBP: 'ğŸ‡¬ğŸ‡§',
            AUD: 'ğŸ‡¦ğŸ‡º', CAD: 'ğŸ‡¨ğŸ‡¦', SGD: 'ğŸ‡¸ğŸ‡¬', CHF: 'ğŸ‡¨ğŸ‡­', JPY: 'ğŸ‡¯ğŸ‡µ',
            ZAR: 'ğŸ‡¿ğŸ‡¦', SEK: 'ğŸ‡¸ğŸ‡ª', NZD: 'ğŸ‡³ğŸ‡¿', THB: 'ğŸ‡¹ğŸ‡­', PHP: 'ğŸ‡µğŸ‡­',
            IDR: 'ğŸ‡®ğŸ‡©', EUR: 'ğŸ‡ªğŸ‡º', KRW: 'ğŸ‡°ğŸ‡·', VND: 'ğŸ‡»ğŸ‡³', MYR: 'ğŸ‡²ğŸ‡¾',
        };

        // æ›´æ–°é å°¾çš„è³‡è¨Š
        function updateInfoFooter(data) {
            if (!data || !data.time_last_update_utc) {
                lastUpdatedEl.textContent = '';
                return;
            }
            const updateDate = new Date(data.time_last_update_utc);
            const utcTime = updateDate.toISOString().substring(0, 19).replace('T', ' ');
            const localTime = updateDate.toLocaleString('sv-SE');
            lastUpdatedEl.textContent = `åŒ¯ç‡æ›´æ–°æ™‚é–“: ${localTime} (ç•¶åœ°) / ${utcTime} (UTC)`;
        }

        // --- ä¸»è¦è²¨å¹£æ›ç®—è¡¨æ ¼ ---

        // è™•ç†è¡¨æ ¼ä¸­çš„æ›ç®—é‚è¼¯
        async function handleTableConversion(event) {
            const sourceInput = event.target;
            const sourceCurrency = sourceInput.dataset.currency;
            const sourceValue = parseFloat(sourceInput.value);

            // å¦‚æœè¼¸å…¥ç„¡æ•ˆæˆ–ç‚ºç©ºï¼Œæ¸…ç©ºæ‰€æœ‰æ¬„ä½
            if (isNaN(sourceValue) || sourceInput.value === '') {
                document.querySelectorAll('#rateTableContainer input').forEach(input => input.value = '');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/${sourceCurrency}`);
                const data = await response.json();
                if (data.result !== 'success') return;

                const rates = data.rates;
                majorCurrencies.forEach(currency => {
                    if (currency === sourceCurrency) return; // è·³éä¾†æºæ¬„ä½
                    const targetInput = document.getElementById(`rate-input-${currency}`);
                    if (targetInput && rates[currency]) {
                        const convertedValue = sourceValue * rates[currency];
                        targetInput.value = parseFloat(convertedValue.toPrecision(8));
                    }
                });

                updateInfoFooter(data);
            } catch (error) {
                console.error('è¡¨æ ¼åŒ¯ç‡æ›ç®—éŒ¯èª¤:', error);
            }
        }

        // åˆå§‹åŒ–ä¸¦ç”Ÿæˆè¡¨æ ¼
        function initializeRateTable() {
            majorCurrencies.forEach(currency => {
                const group = document.createElement('div');
                group.className = 'unit-input-group';

                const label = document.createElement('label');
                label.htmlFor = `rate-input-${currency}`;
                label.innerHTML = `<span class="flag">${currencyFlags[currency] || 'ğŸ³ï¸'}</span> ${currencyNames[currency] || currency} <span class="currency-code">(${currency})</span>`;

                const input = document.createElement('input');
                input.type = 'number';
                input.id = `rate-input-${currency}`;
                input.dataset.currency = currency;

                group.appendChild(label);
                group.appendChild(input);
                rateTableContainerEl.appendChild(group);

                input.addEventListener('input', handleTableConversion);
            });

            resetRateTableBtn.addEventListener('click', () => {
                document.querySelectorAll('#rateTableContainer input').forEach(input => input.value = '');
            });
        }

        // é é¢è¼‰å…¥æ™‚è¨­å®šé è¨­å€¼ (1 ç¾å…ƒ)
        async function setDefaultValue() {
            const usdInput = document.getElementById('rate-input-USD');
            if (!usdInput) return;

            usdInput.value = 1;
            // å»ºç«‹ä¸€å€‹æ¨¡æ“¬çš„äº‹ä»¶å°è±¡ä¾†è§¸ç™¼æ›ç®—
            const event = new Event('input', { bubbles: true, cancelable: true });
            usdInput.dispatchEvent(event);
        }

        // åˆå§‹åŒ–
        async function initializePage() {
            initializeRateTable();
            await setDefaultValue();
        }

        document.addEventListener('DOMContentLoaded', initializePage);

    </script>
</body>
</html>
