<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>密碼產生器 - UNCLE FAT'S TOOL BOX</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="index.html">首頁</a>
        <a href="unitconv.html">單位換算</a>
        <a href="dateconv.html">日期時間換算</a>
        <a href="currency.html">貨幣匯率換算</a>
        <a href="passwordgen.html">密碼產生器</a>
    </div>

    <nav class="navbar">
        <div class="navbar-left">
            <span class="openbtn" onclick="openNav()">&#9776;</span>
            <a href="index.html" class="navbar-brand">UNCLE FAT'S TOOL BOX</a>
        </div>
        <div id="datetime-display" class="nav-links"></div>
    </nav>

    <div class="container">
        <h2><center>密碼產生器</center></h2>

        <div class="calculator-section">
            <div class="password-display-container">
                <input type="text" id="passwordDisplay" readonly placeholder="點擊「產生密碼」來生成">
                <button id="copyBtn" title="複製密碼">複製</button>
            </div>

            <div class="form-group">
                <label for="passwordLength">密碼長度: <span id="passwordLengthValue">16</span></label>
                <input type="range" id="passwordLength" min="4" max="64" value="16">
            </div>

            <div class="form-group-checkbox">
                <input type="checkbox" id="includeUppercase" checked>
                <label for="includeUppercase">包含大寫字母 (A-Z)</label>
            </div>

            <div class="form-group-checkbox">
                <input type="checkbox" id="includeLowercase" checked>
                <label for="includeLowercase">包含小寫字母 (a-z)</label>
            </div>

            <div class="form-group-checkbox">
                <input type="checkbox" id="includeNumbers" checked>
                <label for="includeNumbers">包含數字 (0-9)</label>
            </div>

            <div class="form-group-checkbox">
                <input type="checkbox" id="includeSymbols">
                <label for="includeSymbols">包含符號 (!@#$%^&*)</label>
            </div>

            <button id="generateBtn">產生密碼</button>
        </div>
    </div>

    <script>
        // --- 導覽列時間更新 ---
        function updateDateTime() {
            const now = new Date();
            const dateTimeString = now.toLocaleString('sv-SE').replace('T', ' '); // YYYY-MM-DD HH:MM:SS
            
            const displayElement = document.getElementById('datetime-display');
            if (displayElement) {
                displayElement.textContent = dateTimeString;
            }
        }
        updateDateTime();
        setInterval(updateDateTime, 1000);

        /* Sidebar Functions */
        function openNav() {
            document.getElementById("mySidebar").style.width = "250px";
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
        }
        window.openNav = openNav;
        window.closeNav = closeNav;

        // --- 密碼產生器邏輯 ---
        const passwordDisplay = document.getElementById('passwordDisplay');
        const passwordLength = document.getElementById('passwordLength');
        const passwordLengthValue = document.getElementById('passwordLengthValue');
        const includeUppercase = document.getElementById('includeUppercase');
        const includeLowercase = document.getElementById('includeLowercase');
        const includeNumbers = document.getElementById('includeNumbers');
        const includeSymbols = document.getElementById('includeSymbols');
        const generateBtn = document.getElementById('generateBtn');
        const copyBtn = document.getElementById('copyBtn');

        const uppercaseChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const lowercaseChars = 'abcdefghijklmnopqrstuvwxyz';
        const numberChars = '0123456789';
        const symbolChars = '!@#$%^&*()_+-=[]{}|;:,.<>?';

        // 同步滑桿與數字顯示
        passwordLength.addEventListener('input', (e) => {
            passwordLengthValue.textContent = e.target.value;
        });

        // 產生密碼事件
        generateBtn.addEventListener('click', () => {
            let charPool = '';
            if (includeUppercase.checked) charPool += uppercaseChars;
            if (includeLowercase.checked) charPool += lowercaseChars;
            if (includeNumbers.checked) charPool += numberChars;
            if (includeSymbols.checked) charPool += symbolChars;

            if (charPool === '') {
                alert('請至少選擇一種字元類型！');
                return;
            }

            let password = '';
            const length = parseInt(passwordLength.value, 10);

            // 使用 Crypto API 產生更安全的隨機數
            const randomValues = new Uint32Array(length);
            window.crypto.getRandomValues(randomValues);

            for (let i = 0; i < length; i++) {
                // 使用隨機數來選擇字元池中的索引
                password += charPool[randomValues[i] % charPool.length];
            }

            passwordDisplay.value = password;
        });

        // 複製密碼事件
        copyBtn.addEventListener('click', () => {
            const password = passwordDisplay.value;
            if (!password) {
                alert('沒有可複製的密碼！');
                return;
            }

            navigator.clipboard.writeText(password).then(() => {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '已複製!';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 1500);
            }).catch(err => {
                console.error('無法複製密碼: ', err);
                alert('複製失敗，請手動複製。');
            });
        });

        // 頁面載入時自動產生一個預設密碼
        document.addEventListener('DOMContentLoaded', () => {
            generateBtn.click();
        });

    </script>
</body>
</html>
